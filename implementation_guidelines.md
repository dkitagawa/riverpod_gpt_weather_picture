# 🚨 必須実装ガイドライン - 別スレッド作業時の厳格な指示

## ⚠️ 重要：このガイドラインは絶対に守ること

このドキュメントは、別スレッドでの実装作業において、本スレッドで協議した重要な原則が無視されることを防ぐための**強制的な指示書**です。

## 📋 基本原則（絶対遵守）

### **原則1: 段階的実装の厳格遵守**
```
❌NG: いきなりファイル分割
✅OK: コードレベル整理 → ファイル構造整理
```

### **原則2: diff提示→ユーザー実装の厳格遵守**
```
❌NG: LLMが直接ファイルを書き換える
✅OK: 具体的なdiffを提示 → ユーザーが手動実装
```

### **原則3: 動作確認→コミットの厳格遵守**
```
各ステップ完了時：
1. ユーザーによる動作確認
2. 適切なコミットメッセージでコミット
3. 次ステップ開始前の確認
```

## 🔥 Phase 1 実装時の強制的ワークフロー

### **Step 1A-1: main.dart コードレベル整理**

#### **絶対に従うべき作業順序**

##### **Task 1: WeatherImage責任明確化**
1. **現状分析**: 現在のWeatherImageの問題点を具体的に指摘
2. **diff提示**: 変更前後のコードを明確に提示
3. **実装指示**: ユーザーに手動での変更を指示
4. **動作確認**: ユーザーによる機能確認
5. **コミット**: `refactor(ui): clarify WeatherImage widget responsibility`

##### **Task 2: WeatherText責任明確化**
1. **現状分析**: WeatherTextの現在の問題
2. **diff提示**: 具体的な変更内容
3. **実装指示**: ユーザーによる手動実装
4. **動作確認**: 機能の正常動作確認
5. **コミット**: `refactor(ui): optimize WeatherText display logic`

##### **Task 3: InputColumn状態管理整理**
1. **現状分析**: InputColumnの複雑性の問題
2. **diff提示**: メソッド分離の具体的変更
3. **実装指示**: ユーザーによる実装
4. **動作確認**: 入力機能の動作確認
5. **コミット**: `refactor(ui): separate InputColumn state management logic`

### **実装指示の具体例（必須フォーマット）**

```markdown
## 現在のコード分析
[具体的な問題点の指摘]

## 変更内容（diff）
```diff
- 変更前のコード
+ 変更後のコード
```

## 実装手順
1. lib/main.dart の XX行目を開く
2. [具体的な変更指示]
3. 保存後、`flutter run` で動作確認
4. 問題なければ下記でコミット：
   `git commit -m "refactor(ui): [具体的な変更内容]"`

## 動作確認項目
- [ ] アプリが正常起動
- [ ] [具体的な機能] が正常動作
- [ ] エラーが発生しない
```

## 🚫 絶対にやってはいけないこと

### **❌ 禁止事項1: ファイル分割の先行**
```
❌ 最初からui/widgets/weather_image.dartを作成
✅ main.dart内でWeatherImageクラスを改善してから分割検討
```

### **❌ 禁止事項2: 一括実装**
```
❌ 複数のウィジェットを同時に変更
✅ 1つずつ、動作確認とコミットを繰り返す
```

### **❌ 禁止事項3: 抽象的な指示**
```
❌ "責任を分離してください"
✅ "line 75-89の_datePicker呼び出し部分を_handleDatePickerメソッドに抽出"
```

### **❌ 禁止事項4: 理想形の提示**
```
❌ 最終的なMVVMアーキテクチャの説明
✅ 現在の問題点と次の1ステップのみ提示
```

## 📝 コミットメッセージ規則（厳守）

### **Phase 1A（コードレベル整理）**
- `refactor(ui): clarify [Widget名] responsibility`
- `refactor(logic): separate [機能名] logic in [クラス名]`
- `refactor(structure): organize private methods in [クラス名]`

### **Phase 1B（ファイル分離）**
- `refactor(structure): extract [Widget名] to separate file`
- `refactor(imports): add barrel exports for [ディレクトリ名]`
- `refactor(organization): move [ファイル名] to [ディレクトリ名]`

## 🔄 各ステップでの必須確認事項

### **ステップ開始前**
- [ ] 前ステップのコミットが完了している
- [ ] アプリが正常動作している
- [ ] `flutter analyze` でエラーがない

### **ステップ実行中**
- [ ] diffが具体的に提示されている
- [ ] ユーザーが手動で実装している
- [ ] 1つの変更につき1つのコミット

### **ステップ完了後**
- [ ] 全機能が正常動作する
- [ ] 適切なコミットメッセージでコミット完了
- [ ] 次ステップの準備ができている

## 🎯 Phase 1の最終ゴール

### **Phase 1A完了時の状態**
- main.dart内の各クラス・メソッドが単一責任
- 状態管理ロジックとUI表示ロジックが分離
- メソッドの責任境界が明確
- **ファイル構造は変更せず、コードの質のみ向上**

### **Phase 1B完了時の状態**
- 明確に異なる責任のクラスのみ分離
- barrel exportによるimport管理
- 最小限のフォルダ構造
- **MVVMアーキテクチャには未到達（Phase 2の準備のみ）**

## ⚠️ このガイドラインを無視した場合

1. **即座に作業停止**
2. **原則に戻って作業やり直し**
3. **小ステップでの段階的実装を厳守**

## 🚀 実装開始時の必須チェック

別スレッドで実装開始時は、必ず以下を確認：

- [ ] このガイドラインを最初に参照した
- [ ] final_refactoring_plan.mdの該当Phaseを確認した
- [ ] コードレベル整理→ファイル構造整理の順序を理解した
- [ ] diff提示→ユーザー実装のフローを理解した
- [ ] 各ステップでの動作確認・コミットを理解した

**このガイドラインに従わない実装は、学習効果を大幅に損ない、プロジェクトの成功を阻害します。**